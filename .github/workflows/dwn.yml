name: Download model to Drive

on:
  workflow_dispatch:

jobs:
  upload-model:
    runs-on: ubuntu-latest

    steps:
      - name: Install rclone
        run: |
          curl https://rclone.org/install.sh | sudo bash

      - name: Setup rclone config
        run: |
          mkdir -p ~/.config/rclone
          echo "${{ secrets.RCLONE_CONF_B64 }}" | base64 --decode > ~/.config/rclone/rclone.conf

      - name: Test rclone connection
        run: |
          rclone lsd gdrive:

      - name: Download whisper model
        run: |
          wget -c -O whispermodel.safetensors \
          https://huggingface.co/openai/whisper-large-v3/resolve/main/model.safetensors

      - name: Verify model file
        run: ls -lh whispermodel.safetensors

      - name: Upload to Google Drive
        run: |
          rclone copy whispermodel.safetensors gdrive:termux-test \
            --progress \
            --drive-chunk-size 64M \
            --transfers 1 \
            --tpslimit 10 \
            --retries 10 \
            --low-level-retries 20

