name: Interact With Arc Testnet Contract

on:
  workflow_dispatch:
    inputs:
      ca:
        description: "Contract address"
        required: true

      wpr:
        description: "Deployer private key"
        required: true

      wallets:
        description: "JSON array of wallet addresses"
        required: true

      amount:
        description: "Random transfer amount"
        required: true

  push:
    branches: [ main ]

jobs:
  interact:
    runs-on: ubuntu-latest

    env:
      ARC_TESTNET_RPC_URL: ${{ secrets.ARC_TESTNET_RPC_URL }}
      EMAIL_APP_PASSWORD: ${{ secrets.EMAIL_APP_PASSWORD }}
      CIRCLE_API_KEY: ${{ secrets.CIRCLE_API_KEY }}
      CIRCLE_ENTITY_SECRET: ${{ secrets.CIRCLE_ENTITY_SECRET }}

      # ðŸ‘‡ from workflow_dispatch inputs
      PRIVATE_KEY: ${{ github.event.inputs.wpr }}
      ARC_ERC20_ADDRESS: ${{ github.event.inputs.ca }}
      Amount: ${{ github.event.inputs.amount }}
      wallets: ${{ github.event.inputs.wallets }}

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install Python dependencies
        run: |
          pip install --upgrade pip
          pip install web3 requests
          

      - name: Run interaction script
        run: |
          cd scripts
          python interact.py transfer \
            --to_list "$wallets" \
            --amount "$Amount"
